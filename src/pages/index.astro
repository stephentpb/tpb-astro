---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlockRenderer from '../components/BlockRenderer.astro';
import { sanity } from '../lib/sanity';

const page = await sanity.fetch(
  `*[_type=="page" && slug.current=="home"][0]{
    title,
    // We need to tell Sanity to look inside the content array
    content[]{
      ..., // This grabs all standard fields (text, headings)
      // This "dereferences" the images to get their actual URLs
      "backgroundImage": backgroundImage.asset->url,
      "floatingImage": floatingImage.asset->url,
      "image": image.asset->url
    },
    seoTitle,
    seoDescription,
    "seoImage": seoImage.asset->url
  }`
);

if (!page) throw new Error('Homepage not found');
---
<BaseLayout
  title={page.seoTitle || page.title}
  description={page.seoDescription}
  ogImage={page.seoImage}
>
  <BlockRenderer blocks={page.content} />
</BaseLayout>
